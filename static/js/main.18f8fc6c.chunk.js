(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{118:function(e,n,t){e.exports=t(298)},123:function(e,n,t){},125:function(e,n,t){},141:function(e,n){},145:function(e,n){},161:function(e,n){},187:function(e,n){},189:function(e,n){},211:function(e,n){},278:function(e,n){},298:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),c=t(113),u=t.n(c),i=(t(123),t(5)),l=t.n(i),o=t(29),s=t(114),d=t(115),g=t(23),m=t(117),h=t(116),f=(t(125),t(16)),w=t(65),_=t.n(w),p=(f.keyStores,f.KeyPair,f.connect,f.utils),b=_()(10).pow(12),v=(_()(200).mul(b),"contract1234501.testnet"),E=function(e){Object(m.a)(t,e);var n=Object(h.a)(t);function t(e){var a;return Object(s.a)(this,t),(a=n.call(this,e)).state={connected:!1,signedIn:!1,accountId:null,contract_sign_accountId:"owner123.testnet",new_crowdfunding_theme:"",new_crowdfunding_receiver:"",new_crowdfunding_funding_goal:0,crowdFunding_campagins:new Array,crowdFunding_funding_map:new Map,crowdFunding_fundings:new Array,crowdfunding_num:0,crowdfunding_goal:0},a.handleNewCrowdChange=a.handleNewCrowdChange.bind(Object(g.a)(a)),a.handleNewReceiverChange=a.handleNewReceiverChange.bind(Object(g.a)(a)),a.handleNewFundingGoalChange=a.handleNewFundingGoalChange.bind(Object(g.a)(a)),a.createNewCrowdSubmit=a.createNewCrowdSubmit.bind(Object(g.a)(a)),a.sendCrowdFundGoalSubmit=a.sendCrowdFundGoalSubmit.bind(Object(g.a)(a)),a._initNear().then((function(){a.setState({connected:!0,signedIn:!!a._accountId,accountId:a._accountId})})),a}return Object(d.a)(t,[{key:"handleNewCrowdChange",value:function(e){console.log("\u52df\u6350\u6d3b\u52a8\u540d\u79f0\uff1a"+e.target.value),this.setState({new_crowdfunding_theme:e.target.value})}},{key:"handleNewReceiverChange",value:function(e){console.log("\u52df\u6350\u6d3b\u52a8\u63a5\u6536\u8d26\u6237\uff1a"+e.target.value),this.setState({new_crowdfunding_receiver:e.target.value})}},{key:"handleNewFundingGoalChange",value:function(e){console.log("\u52df\u6350\u6d3b\u52a8\u7b79\u96c6\u76ee\u6807\u91d1\u989d\uff1a"+e.target.value),this.setState({new_crowdfunding_funding_goal:e.target.value})}},{key:"handlewCrowdFundingNumChange",value:function(e){console.log("\u53c2\u4e0e\u52df\u6350\u6d3b\u52a8\u7684\u7f16\u53f7\uff1a"+e.target.value),this.setState({crowdfunding_num:e.target.value})}},{key:"handlewCrowdFundingGoalChange",value:function(e){console.log("\u53c2\u4e0e\u52df\u6350\u7684\u91d1\u989d\uff1a"+e.target.value),this.setState({crowdfunding_goal:e.target.value})}},{key:"createNewCrowdSubmit",value:function(e){this.createNewCrowd(),e.preventDefault()}},{key:"createNewCrowd",value:function(){var e=Object(o.a)(l.a.mark((function e(){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._contract.newCampaign({theme:this.state.new_crowdfunding_theme,receiver:this.state.new_crowdfunding_receiver,number_funders:0,funding_goal:Number(this.state.new_crowdfunding_funding_goal)});case 2:if(!((n=e.sent)>0)){e.next=8;break}if(alert("\u5408\u7ea6\u521b\u5efa\u6210\u529f\uff0c\u5408\u7ea6\u7f16\u53f7\uff1a"+n),!this._accountId){e.next=8;break}return e.next=8,this.refreshAccountStats();case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendCrowdFundGoalSubmit",value:function(e){this.bidCrowdFund(),e.preventDefault()}},{key:"bidCrowdFund",value:function(){var e=Object(o.a)(l.a.mark((function e(){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._account.functionCall({contractId:v,methodName:"bid",args:{num_campagins:Number(this.state.crowdfunding_num)},gas:"300000000000000",attachedDeposit:p.format.parseNearAmount(this.state.crowdfunding_goal)});case 2:if(!((n=e.sent)>0)){e.next=8;break}if(console.log("\u7b2c\uff1a"+n+"\u4f4d\u6350\u8d60\u4eba"),!this._accountId){e.next=8;break}return e.next=8,this.refreshAccountStats();case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initNear",value:function(){var e=Object(o.a)(l.a.mark((function e(){var n,t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={networkId:"default",nodeUrl:"https://rpc.testnet.near.org",contractName:v,walletUrl:"https://wallet.testnet.near.org"},t=new f.keyStores.BrowserLocalStorageKeyStore,e.next=4,f.connect(Object.assign({deps:{keyStore:t}},n));case 4:if(a=e.sent,this._keyStore=t,this._nearConfig=n,this._near=a,this._walletConnection=new f.WalletConnection(a,v),this._accountId=this._walletConnection.getAccountId(),this._account=this._walletConnection.account(),console.log("_accountId="+this._accountId+", _account="+this._account),this._contract=new f.Contract(this._account,v,{viewMethods:["get_crowdFunding_by_num_campagins","get_all_crowdFunding","get_funders_by_num_campagins"],changeMethods:["newCampaign","bid"]}),!this._accountId){e.next=16;break}return e.next=16,this.refreshAccountStats();case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshAccountStats",value:function(){var e=Object(o.a)(l.a.mark((function e(){var n,t,a,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._contract.get_all_crowdFunding();case 2:n=e.sent,t=0;case 4:if(!(t<n.length)){e.next=15;break}return(a=n[t]).num_campagins=t+1,this.state.crowdFunding_campagins.push(a),e.next=10,this._contract.get_funders_by_num_campagins({num_campagins:a.num_campagins});case 10:(r=e.sent).length>0&&this.state.crowdFunding_funding_map.set(a.num_campagins,r);case 12:t++,e.next=4;break;case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"requestSignIn",value:function(){var e=Object(o.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"\u53bb\u4e2d\u5fc3\u5316\u52df\u6350\u5e73\u53f0",e.next=3,this._walletConnection.requestSignIn(v,"\u53bb\u4e2d\u5fc3\u5316\u52df\u6350\u5e73\u53f0");case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"logOut",value:function(){var e=Object(o.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._walletConnection.signOut(),this._accountId=null,this.setState({signedIn:!!this._accountId,accountId:this._accountId});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;console.log("call render().");var n=this.state.connected?this.state.signedIn?r.a.createElement("div",null,r.a.createElement("div",{className:"float-right"},r.a.createElement("button",{className:"btn btn-outline-secondary",onClick:function(){return e.logOut()}},"\u9000\u51fa")),r.a.createElement("h5",null,r.a.createElement("span",{className:"font-weight-bold"},"\u5f53\u524d\u767b\u9646NEAR\u8d26\u53f7\uff1a",this.state.accountId)),r.a.createElement("div",null),this.state.contract_sign_accountId===this.state.accountId?r.a.createElement("div",null,r.a.createElement("h6",null,r.a.createElement("span",{className:"font-weight-bold"},"\u60a8\u6709\u6743\u521b\u5efa\u52df\u6350\u6d3b\u52a8")),r.a.createElement("hr",null),r.a.createElement("label",{style:{marginTop:"10px"}}," \u3013 \u521b\u5efa\u52df\u6350\u6d3b\u52a8\u3013 "),r.a.createElement("form",{onSubmit:this.createNewCrowdSubmit},r.a.createElement("label",null,"\u6d3b\u52a8\u540d\u79f0\uff1a ",r.a.createElement("input",{type:"text",style:{marginLeft:"10px"},value:this.state.new_crowdfunding_theme,onChange:function(n){e.handleNewCrowdChange(n)}})," "),r.a.createElement("br",null),r.a.createElement("label",null,"\u63a5\u6536\u52df\u6350\u8d26\u6237\uff1a",r.a.createElement("input",{type:"text",style:{marginLeft:"10px"},value:this.state.new_crowdfunding_receiver,onChange:function(n){e.handleNewReceiverChange(n)}})," "),r.a.createElement("br",null),r.a.createElement("label",null,"\u52df\u6350\u76ee\u6807\u91d1\u989d\uff1a ",r.a.createElement("input",{type:"number",style:{marginLeft:"10px"},value:this.state.new_crowdfunding_funding_goal,onChange:function(n){e.handleNewFundingGoalChange(n)}})," "),r.a.createElement("br",null),r.a.createElement("input",{type:"submit",value:"\u63d0\u4ea4"})),r.a.createElement("hr",null),r.a.createElement("div",{style:{fontSize:"16px"}},r.a.createElement("label",null," \u3013 \u5df2\u521b\u5efa\u7684\u52df\u6350\u6d3b\u52a8\u5217\u8868 \u3013 ")," ",r.a.createElement("br",null),this.state.crowdFunding_campagins.map((function(n){return r.a.createElement("li",{key:n},"\u300e\u7f16\u53f7\u300f\uff1a",n.num_campagins+", "," \u300e\u6d3b\u52a8\u540d\u79f0\u300f\uff1a",n.theme+", "," \u300e\u52df\u6350\u63a5\u6536\u8d26\u6237\u300f\uff1a",n.receiver+", "," \u300e\u52df\u8d44\u76ee\u6807\u91d1\u989d\u300f\uff1a",n.funding_goal+"NEAR, "," \u300e\u52df\u8d44\u53c2\u4e0e\u4eba\u6570\u300f\uff1a",n.number_funders+", ","  \u300e\u5df2\u7ecf\u52df\u96c6\u7684\u91d1\u989d\u300f\uff1a",n.total_amount+" yoctoNEAR",r.a.createElement("br",null),r.a.createElement("label",{style:{fontSize:"13px"}},"  \u273f \u52df\u6350\u4eba\u5217\u8868 ")," ",r.a.createElement("br",null),r.a.createElement("div",{style:{fontSize:"10px"}},null!=e.state.crowdFunding_funding_map.get(n.num_campagins)&&void 0!=e.state.crowdFunding_funding_map.get(n.num_campagins)&&e.state.crowdFunding_funding_map.get(n.num_campagins).length>0?e.state.crowdFunding_funding_map.get(n.num_campagins).map((function(e){return r.a.createElement("div",{key:e}," \u25e6  \u6350\u8d60\u4eba\u5730\u5740\uff1a",e.addr+", "," \u6350\u8d60\u91d1\u989d\uff1a",e.amount+" yoctoNEAR"," ",r.a.createElement("br",null))})):r.a.createElement("label",null," \u65e0\u6350\u8d60\u4eba.")))}))),r.a.createElement("br",null),r.a.createElement("hr",null)):r.a.createElement("div",null,r.a.createElement("h6",null,r.a.createElement("span",{className:"font-weight-bold"},"\u6b22\u8fce\u60a8\u53c2\u4e0e\u52df\u6350\u6d3b\u52a8")),r.a.createElement("hr",null),r.a.createElement("label",null," \u8bf7\u9009\u62e9\u60a8\u8981\u53c2\u4e0e\u7684\u52df\u6350\u6d3b\u52a8 ")," ",r.a.createElement("br",null),this.state.crowdFunding_campagins.map((function(e){return r.a.createElement("label",null,"\u300e\u7f16\u53f7\u300f: ",e.num_campagins+", "," \u300e\u6d3b\u52a8\u540d\u79f0\u300f: ",e.theme+", "," \u300e\u52df\u6350\u63a5\u6536\u8d26\u6237\u300f: ",e.receiver+", "," \u300e\u52df\u6350\u4eba\u6570\u300f: ",e.number_funders,r.a.createElement("br",null))})),r.a.createElement("hr",null),r.a.createElement("form",{onSubmit:this.sendCrowdFundGoalSubmit},r.a.createElement("label",null,"\u6d3b\u52a8\u7f16\u53f7\uff1a ",r.a.createElement("input",{type:"text",style:{marginLeft:"10px"},value:this.state.crowdfunding_num,onChange:function(n){e.handlewCrowdFundingNumChange(n)}})," (-\u8bf7\u9009\u62e9\u4e0a\u9762\u7684\u6d3b\u52a8\u7f16\u53f7-)"),r.a.createElement("br",null),r.a.createElement("label",null,"\u52df\u6350\u91d1\u989d\uff1a ",r.a.createElement("input",{type:"number",style:{marginLeft:"10px"},value:this.state.crowdfunding_goal,onChange:function(n){e.handlewCrowdFundingGoalChange(n)}})," NEAR"),r.a.createElement("br",null),r.a.createElement("input",{type:"submit",value:"\u63d0\u4ea4"})))):r.a.createElement("div",{style:{marginBottom:"10px"}},r.a.createElement("button",{className:"btn btn-primary",onClick:function(){return e.requestSignIn()}},"\u767b\u9646NEAR\u94b1\u5305")):r.a.createElement("div",null,"\u6b63\u5728\u94fe\u63a5NEAR\u94b1\u5305 ...",r.a.createElement("span",{className:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"}));return r.a.createElement("div",{className:"px-5"},r.a.createElement("h1",null,"NEAR\u53bb\u4e2d\u5fc3\u5316\u52df\u6350\u6d3b\u52a8\u5e73\u53f0"),r.a.createElement("span",{className:"font-weight-light"},"(\u63d0\u793a\u26a0\ufe0f\uff1a\u52df\u6350\u6d3b\u52a8\u5408\u7ea6\u5df2\u7ecf\u90e8\u7f72\u5230\u6d4b\u8bd5\u94fe\uff0c\u5408\u7ea6\u8d26\u6237\uff1a",v,"\uff0c\u6388\u6743\u8d26\u6237\uff1a",this.state.contract_sign_accountId,")"),n)}}]),t}(r.a.Component);u.a.render(r.a.createElement(E,null),document.getElementById("root"))}},[[118,1,2]]]);
//# sourceMappingURL=main.18f8fc6c.chunk.js.map